<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aurora Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
    }

    .page-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 2rem;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.25rem;
    }

    header nav {
      display: flex;
      gap: 0.5rem;
    }

    header nav button {
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      background: #1f2937;
      color: #e5e7eb;
      font-size: 0.9rem;
      cursor: pointer;
      white-space: nowrap;
    }

    header nav button.active {
      background: #4f46e5;
    }

    header nav button:hover {
      background: #4f46e5;
    }

    main {
      flex: 1;
      padding: 1.5rem;
      max-width: 960px;
      margin: 0 auto;
      width: 100%;
    }

    .card {
      background: #020617;
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid #1f2937;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      margin-bottom: 1.5rem;
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .row > .col {
      flex: 1 1 200px;
    }

    .big-balance {
      font-size: 2rem;
      font-weight: 600;
    }

    .label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }

    .muted {
      color: #9ca3af;
      font-size: 0.85rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    table th, table td {
      padding: 0.5rem 0.75rem;
      text-align: left;
      border-bottom: 1px solid #1f2937;
    }

    table th {
      font-weight: 500;
      color: #9ca3af;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.06em;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: #1f2937;
      font-size: 0.75rem;
      color: #e5e7eb;
    }

    .status-pill span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* Transfer / Escrow shared styles */

    .field {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    input, select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #4f46e5;
    }

    .hint {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: 0.15rem;
    }

    .btn-primary, .btn-secondary, .btn-ghost {
      border-radius: 999px;
      padding: 0.6rem 1.1rem;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .btn-primary {
      background: #4f46e5;
      color: white;
    }

    .btn-secondary {
      background: #1f2937;
      color: #e5e7eb;
    }

    .btn-ghost {
      background: transparent;
      color: #9ca3af;
    }

    .btn-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .timer {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 0.75rem;
    }

    .escrow-summary {
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }

    .escrow-summary div {
      margin-bottom: 0.25rem;
    }

    .alert {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      background: #111827;
      border: 1px solid #374151;
    }

    @media (max-width: 640px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      header nav {
        width: 100%;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body onload="initApp()">
  <div class="page-wrapper">
    <header>
      <h1>Aurora Wallet</h1>
      <nav>
        <button type="button" data-view="dashboard" class="active" onclick="showView('dashboard')">Dashboard</button>
        <button type="button" data-view="transfer" onclick="showView('transfer')">Transfer</button>
        <!-- Escrow not in nav; only via flow -->
      </nav>
    </header>

    <main>
      <!-- DASHBOARD VIEW -->
      <section id="view-dashboard" class="view active">
        <div class="card">
          <h2>Overview</h2>
          <div class="row">
            <div class="col">
              <div class="label">Available Balance</div>
              <div class="big-balance" id="availableBalance">$4,792.00</div>
              <div class="muted">
                Base: <span id="baseBalance">$4,792.00</span> · In escrow:
                <span id="escrowHeld">$0.00</span>
              </div>
            </div>
            <div class="col">
              <div class="label">Primary Wallet</div>
              <div style="font-size:0.9rem;">aurora-main-9x7af2</div>
              <div class="muted" style="margin-top:0.25rem;">Network: Multi-chain</div>
            </div>
            <div class="col">
              <div class="label">Escrow Status</div>
              <div class="status-pill">
                <span class="dot"></span>
                <span id="escrowStatusLabelDashboard">No active escrow</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Recent Activity</h2>
          <table>
            <thead>
              <tr>
                <th>Time</th>
                <th>Type</th>
                <th>Amount</th>
                <th>From / To</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>11/27/2025, 03:15 PM</td>
                <td>Receive</td>
                <td>+$1,200.00</td>
                <td>Kraken Deposit</td>
                <td>Confirmed</td>
              </tr>
              <tr>
                <td>11/27/2025, 09:40 AM</td>
                <td>Send</td>
                <td>-$350.00</td>
                <td>Ledger Vault 01</td>
                <td>Completed</td>
              </tr>
              <tr>
                <td>11/26/2025, 05:22 PM</td>
                <td>Receive</td>
                <td>+$890.00</td>
                <td>Coinbase Funding</td>
                <td>Confirmed</td>
              </tr>
            </tbody>
          </table>
          <p class="muted" style="margin-top:0.5rem;">
            Escrow transfers created on the Transfer view are reflected in the balance and status above.
          </p>
        </div>
      </section>

      <!-- TRANSFER VIEW -->
      <section id="view-transfer" class="view">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
            <h2>Send to Escrow</h2>
            <div class="status-pill">
              <span class="dot"></span>
              <span id="escrowStatusLabelTransfer">No active escrow</span>
            </div>
          </div>

          <p class="muted">
            Available balance: <span id="availableBalanceTransfer">$4,792.00</span>
          </p>

          <form id="transferForm" onsubmit="handleTransferSubmit(event)">
            <div class="field">
              <label for="fromWallet">From wallet</label>
              <select id="fromWallet" required>
                <option value="Aurora Main Wallet">Aurora Main Wallet (Balance: $4,792.00)</option>
                <option value="Aurora Trading Wallet">Aurora Trading Wallet (Balance: $0.00)</option>
                <option value="Aurora Cold Storage">Aurora Cold Storage (Balance: $0.00)</option>
              </select>
            </div>

            <div class="field">
              <label for="recipientWallet">Recipient wallet / BTC address</label>
              <input
                id="recipientWallet"
                type="text"
                required
                placeholder="e.g. bc1qxy2kgdygj..."
              />
              <div class="hint">Final destination wallet for the transfer.</div>
            </div>

            <div class="field">
              <label for="escrowWallet">Escrow wallet / BTC address</label>
              <input
                id="escrowWallet"
                type="text"
                required
                placeholder="e.g. 3FZbgi29cpjq..."
              />
              <div class="hint">Escrow holding address used during the 15-minute window.</div>
            </div>

            <div class="field">
              <label for="amount">Amount (USD)</label>
              <input
                id="amount"
                type="number"
                step="0.01"
                min="0"
                required
                placeholder="1250.00"
              />
            </div>

            <div class="btn-row">
              <button type="submit" class="btn-primary">Send / Pay</button>
              <button type="button" class="btn-ghost" onclick="document.getElementById('transferForm').reset();">
                Clear
              </button>
            </div>

            <p class="muted" style="margin-top:0.75rem;">
              After clicking Send / Pay, funds move to escrow for 15 minutes and you will be taken to the Escrow view.
            </p>
          </form>
        </div>
      </section>

      <!-- ESCROW VIEW -->
      <section id="view-escrow" class="view">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
            <h2>Escrow Confirmation</h2>
            <div class="status-pill">
              <span class="dot"></span>
              <span id="escrowStatusLabelEscrow">Escrow status</span>
            </div>
          </div>

          <p id="escrowIntro">
            This transfer has been placed into escrow. You can accept or cancel it before the timer reaches zero.
          </p>

          <div class="escrow-summary">
            <div><span class="label">Amount</span> <span id="escrowAmount">–</span></div>
            <div><span class="label">From wallet</span> <span id="escrowFrom">–</span></div>
            <div><span class="label">Recipient wallet</span> <span id="escrowRecipientWallet">–</span></div>
            <div><span class="label">Escrow wallet</span> <span id="escrowEscrowWallet">–</span></div>
          </div>

          <div class="label" style="margin-top:1rem;">Time remaining</div>
          <div class="timer" id="escrowTimer">15:00</div>

          <div class="btn-row">
            <button id="btnAccept" class="btn-primary" type="button" onclick="escrowAccept()">
              Accept
            </button>
            <button id="btnCancel" class="btn-secondary" type="button" onclick="escrowCancel()">
              Cancel
            </button>
            <button class="btn-ghost" type="button" onclick="showView('dashboard')">
              Back to Dashboard
            </button>
          </div>

          <div class="alert" id="escrowAlert" style="display:none;"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    var BASE_BALANCE = 4792.00;
    var ESCROW_DURATION_SECONDS = 15 * 60;
    var escrowTimerId = null;
    var escrowSecondsRemaining = 0;
    var escrowActive = false;

    function getEscrowStatus() {
      return localStorage.getItem("auroraEscrowStatus") || "none";
    }
    function setEscrowStatus(status) {
      localStorage.setItem("auroraEscrowStatus", status);
    }
    function getEscrowData() {
      var raw = localStorage.getItem("auroraEscrowData");
      if (!raw) return null;
      try { return JSON.parse(raw); } catch (e) { return null; }
    }
    function saveEscrowData(data) {
      localStorage.setItem("auroraEscrowData", JSON.stringify(data));
    }
    function formatCurrency(num) {
      return "$" + Number(num || 0).toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }
    function formatTime(seconds) {
      var m = Math.floor(seconds / 60);
      var s = seconds % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }
    function computeAvailableBalance() {
      var status = getEscrowStatus();
      var data = getEscrowData();
      var amountInEscrow = 0;
      if (status === "active" && data && typeof data.amount === "number") {
        amountInEscrow = data.amount;
      }
      return BASE_BALANCE - amountInEscrow;
    }

    function showView(name) {
      var views = document.getElementsByClassName("view");
      for (var i = 0; i < views.length; i++) {
        views[i].classList.remove("active");
      }
      var target = document.getElementById("view-" + name);
      if (target) target.classList.add("active");

      var buttons = document.querySelectorAll("header nav button");
      for (var j = 0; j < buttons.length; j++) {
        var btn = buttons[j];
        var v = btn.getAttribute("data-view");
        btn.classList.toggle("active", v === name);
      }

      if (name === "dashboard") updateDashboardUI();
      if (name === "transfer") updateTransferUI();
      if (name === "escrow")   initEscrowView();
    }

    function updateDashboardUI() {
      var status = getEscrowStatus();
      var data = getEscrowData();
      var amountInEscrow = 0;
      if (status === "active" && data && typeof data.amount === "number") {
        amountInEscrow = data.amount;
      }
      var available = BASE_BALANCE - amountInEscrow;
      document.getElementById("baseBalance").textContent = formatCurrency(BASE_BALANCE);
      document.getElementById("availableBalance").textContent = formatCurrency(available);
      document.getElementById("escrowHeld").textContent = formatCurrency(amountInEscrow);

      var label = document.getElementById("escrowStatusLabelDashboard");
      label.textContent =
        status === "active"   ? "Escrow active" :
        status === "completed"? "Escrow accepted (completed)" :
        status === "canceled" ? "Escrow canceled, funds returned" :
        status === "expired"  ? "Escrow expired" :
                                "No active escrow";
    }

    function updateTransferUI() {
      var status = getEscrowStatus();
      var available = computeAvailableBalance();
      document.getElementById("availableBalanceTransfer").textContent = formatCurrency(available);
      var label = document.getElementById("escrowStatusLabelTransfer");
      label.textContent =
        status === "active"   ? "Escrow active" :
        status === "completed"? "Escrow accepted (completed)" :
        status === "canceled" ? "Escrow canceled, funds returned" :
        status === "expired"  ? "Escrow expired" :
                                "No active escrow";
    }

    function updateEscrowStatusLabelEscrow() {
      var status = getEscrowStatus();
      var label = document.getElementById("escrowStatusLabelEscrow");
      label.textContent =
        status === "active"   ? "Escrow active" :
        status === "completed"? "Escrow accepted (completed)" :
        status === "canceled" ? "Escrow canceled, funds returned" :
        status === "expired"  ? "Escrow expired" :
                                "No active escrow";
    }

    function updateTimerDisplay() {
      document.getElementById("escrowTimer").textContent = formatTime(escrowSecondsRemaining);
    }
    function showAlert(msg) {
      var el = document.getElementById("escrowAlert");
      el.textContent = msg;
      el.style.display = "block";
    }
    function hideAlert() {
      var el = document.getElementById("escrowAlert");
      el.textContent = "";
      el.style.display = "none";
    }
    function setEscrowButtonsEnabled(enabled) {
      document.getElementById("btnAccept").disabled = !enabled;
      document.getElementById("btnCancel").disabled = !enabled;
    }
    function computeSecondsRemaining(createdAt) {
      if (!createdAt) return 0;
      var elapsed = Math.floor((Date.now() - createdAt) / 1000);
      return Math.max(0, ESCROW_DURATION_SECONDS - elapsed);
    }
    function handleEscrowExpired() {
      escrowActive = false;
      setEscrowStatus("expired");
      updateEscrowStatusLabelEscrow();
      setEscrowButtonsEnabled(false);
      showAlert("The escrow timer has expired. This transfer can no longer be accepted or canceled.");
    }
    function startEscrowTimer(initialSeconds) {
      escrowSecondsRemaining = initialSeconds;
      updateTimerDisplay();
      if (escrowTimerId) clearInterval(escrowTimerId);
      escrowTimerId = setInterval(function() {
        escrowSecondsRemaining--;
        if (escrowSecondsRemaining <= 0) {
          escrowSecondsRemaining = 0;
          clearInterval(escrowTimerId);
          handleEscrowExpired();
        }
        updateTimerDisplay();
      }, 1000);
    }

    function initEscrowView() {
      hideAlert();
      var data = getEscrowData();
      var intro = document.getElementById("escrowIntro");
      if (!data) {
        document.getElementById("escrowAmount").textContent = "—";
        document.getElementById("escrowFrom").textContent = "—";
        document.getElementById("escrowRecipientWallet").textContent = "—";
        document.getElementById("escrowEscrowWallet").textContent = "—";
        escrowActive = false;
        escrowSecondsRemaining = 0;
        updateTimerDisplay();
        setEscrowButtonsEnabled(false);
        setEscrowStatus("none");
        updateEscrowStatusLabelEscrow();
        intro.textContent = "No escrow transfer is currently stored. Create one from the Transfer view.";
        return;
      }

      document.getElementById("escrowAmount").textContent = data.amountFormatted || "—";
      document.getElementById("escrowFrom").textContent = data.fromWallet || "—";
      document.getElementById("escrowRecipientWallet").textContent = data.recipientWallet || "—";
      document.getElementById("escrowEscrowWallet").textContent = data.escrowWallet || "—";

      var status = getEscrowStatus() || data.status || "none";
      updateEscrowStatusLabelEscrow();

      if (status === "active") {
        var remaining = computeSecondsRemaining(data.createdAt);
        if (remaining <= 0) {
          handleEscrowExpired();
        } else {
          escrowActive = true;
          setEscrowButtonsEnabled(true);
          startEscrowTimer(remaining);
        }
      } else {
        escrowActive = false;
        escrowSecondsRemaining = 0;
        updateTimerDisplay();
        setEscrowButtonsEnabled(false);

        if (status === "completed") {
          showAlert("This escrow transfer has already been accepted and completed.");
        } else if (status === "canceled") {
          showAlert("This escrow transfer has been canceled. Funds have been returned to the sender wallet.");
        } else if (status === "expired") {
          showAlert("The escrow timer expired. This transfer can no longer be changed.");
        } else {
          intro.textContent = "No active escrow transfer is stored. Create one from the Transfer view.";
        }
      }
    }

    function handleTransferSubmit(e) {
      if (e && e.preventDefault) e.preventDefault();
      var fromWallet = document.getElementById("fromWallet").value;
      var recipientWallet = document.getElementById("recipientWallet").value.trim();
      var escrowWallet = document.getElementById("escrowWallet").value.trim();
      var amount = parseFloat(document.getElementById("amount").value.trim());

      if (!recipientWallet || !escrowWallet || isNaN(amount) || amount <= 0) {
        alert("Please enter valid recipient address, escrow address, and amount.");
        return false;
      }
      var available = computeAvailableBalance();
      if (amount > available) {
        alert("This amount exceeds your available balance.");
        return false;
      }

      var data = {
        amount: amount,
        amountFormatted: formatCurrency(amount),
        fromWallet: fromWallet,
        recipientWallet: recipientWallet,
        escrowWallet: escrowWallet,
        createdAt: Date.now(),
        status: "active"
      };
      saveEscrowData(data);
      setEscrowStatus("active");
      showView("escrow");
      return false;
    }

    function escrowAccept() {
      if (!escrowActive) return;
      escrowActive = false;
      if (escrowTimerId) clearInterval(escrowTimerId);
      setEscrowStatus("completed");
      var data = getEscrowData() || {};
      data.status = "completed";
      saveEscrowData(data);
      updateEscrowStatusLabelEscrow();
      setEscrowButtonsEnabled(false);
      showAlert("Escrow accepted. The transfer has been completed.");
      updateDashboardUI();
    }

    function escrowCancel() {
      if (!escrowActive) return;
      escrowActive = false;
      if (escrowTimerId) clearInterval(escrowTimerId);
      setEscrowStatus("canceled");
      var data = getEscrowData() || {};
      data.status = "canceled";
      saveEscrowData(data);
      updateEscrowStatusLabelEscrow();
      setEscrowButtonsEnabled(false);
      showAlert("Escrow canceled. Funds have been returned to the sender wallet.");
      updateDashboardUI();
    }

    function initApp() {
      updateDashboardUI();
      updateTransferUI();
    }
  </script>
</body>
</html>
